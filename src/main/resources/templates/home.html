<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>
        <!-- Título dinâmico baseado no papel do usuário -->
        <th:block sec:authorize="hasRole('ADMIN')">Painel do Administrador</th:block>
        <th:block sec:authorize="hasRole('TESTER') and !hasRole('ADMIN')">Painel do Testador</th:block>
        <th:block sec:authorize="isAnonymous()">Bem-vindo à GameTests Platform</th:block>
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS Unificado de todas as páginas -->
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif; background-color: #121212;
            color: #f0f0f0; margin: 0; padding: 0;
            display: flex; flex-direction: column; min-height: 100vh;
            overflow-x: hidden;
        }
        .page-footer {
            text-align: center; padding: 15px 5%; background-color: #1f1f1f;
            color: #888; font-size: 0.85em; border-top: 1px solid #2f2f2f;
        }

        /* === Estilos do Header (Público, Testador, Admin) === */
        .page-header {
            background-color: #1f1f1f; padding: 20px 40px; display: flex;
            justify-content: space-between; align-items: center;
            border-bottom: 2px solid #00BFFF; box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .page-header.public-header { padding: 15px 5%; }
        .page-header .logo-title h1 { color: #00BFFF; margin: 0; font-size: 2em; }
        .page-header .logo-title p { margin: 5px 0 0; font-size: 0.9em; color: #aaaaaa; }
        .page-header.public-header .logo-title h1 { font-size: 1.6em; }
        .page-header.public-header .logo-title p { font-size: 0.8em; }

        .page-header .auth-links a, .page-header .user-info a {
            color: #00BFFF; text-decoration: none; font-weight: 500;
            margin-left: 15px; transition: background-color 0.2s, color 0.2s;
        }
        .page-header .auth-links a {
            padding: 7px 12px; border: 1px solid #00BFFF;
            border-radius: 4px; font-size: 0.85em;
        }
        .page-header .auth-links a:hover { background-color: #00BFFF; color: #121212; }
        .page-header .user-info a:hover { text-decoration: underline; }
        .page-header .user-info button {
            background: none; border: none; color: #00BFFF; font-weight: bold;
            cursor: pointer; font-size: 1em; padding: 0; margin-left: 20px;
        }
        .page-header .user-info button:hover { text-decoration: underline; }

        /* === Estilos do Conteúdo (Comuns e Específicos) === */
        .page-content-container, .dashboard-container {
            flex-grow: 1; padding: 30px 5%; max-width: 1200px; margin: 0 auto;
            width: 100%;
        }
        .page-content-container { justify-content: center; align-items: center; display: flex; flex-direction: column; }
        .welcome-title { font-size: 2em; color: #00BFFF; text-align: center; margin-bottom: 10px; }
        .welcome-subtitle { font-size: 1.1em; color: #cccccc; text-align: center; margin-bottom: 30px; max-width: 600px; }
        .welcome-message {
            background-color: #1f1f1f; padding: 20px; border-radius: 8px; margin-bottom: 30px;
            border-left: 5px solid #00BFFF;
        }
        .welcome-message h2 { margin-top: 0; color: #f0f0f0; }
        .welcome-message p { color: #cccccc; }
        .welcome-message .button-primary {
            background-color: #00BFFF; color: white; padding: 10px 20px; text-decoration: none;
            border-radius: 5px; font-weight: bold; transition: background-color 0.2s;
        }
        .welcome-message .button-primary:hover { background-color: #009ACD; }

        .management-card, .content-card {
            background-color: #1f1f1f; padding: 25px; border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }
        .management-card h3, .content-card h3 {
            color: #00BFFF; margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid #333;
            padding-bottom: 10px; font-size: 1.4em;
        }

        .dashboard-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;
        }
        @media (min-width: 992px) {
            .dashboard-grid { grid-template-columns: 2fr 1fr; }
            .main-content-area { display: flex; flex-direction: column; gap: 25px; }
        }

        .management-sections {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px;
        }

        /* Outros estilos específicos (listas, botões, etc.) */
        .content-card .list-item, .estrategia-item { padding: 10px; border-bottom: 1px solid #2a2a2a; }
        .content-card .list-item { background-color: #272727; padding: 15px; margin-bottom: 10px; border-radius: 6px; border-left: 4px solid #00BFFF; }
        .content-card .list-item:hover { background-color: #333; }
        .content-card .list-item p, .estrategia-item p { margin: 0; color: #cccccc; font-size: 0.9em; }
        .content-card .list-item .status { font-weight: bold; }
        .content-card .list-item .status-CRIADO { color: #87CEFA; }
        .content-card .list-item .status-EM_EXECUCAO { color: #FFD700; }
        .content-card .list-item .status-FINALIZADO { color: #32CD32; }
        .content-card .list-item .status-CANCELADO { color: #FF6347; }
        .content-card .action-link, .content-card .view-all-link { display: inline-block; margin-top: 15px; color: #00BFFF; text-decoration: none; font-weight: bold; }
        .content-card .action-link:hover, .content-card .view-all-link:hover { text-decoration: underline; }
        .management-card .button {
            background-color: #00BFFF; color: white; border: none; padding: 10px 15px; border-radius: 5px;
            cursor: pointer; text-decoration: none; font-weight: bold; text-align: center;
            font-size: 0.95em; transition: background-color 0.2s, transform 0.1s; display: block;
        }
        .management-card .button:hover { background-color: #009ACD; transform: translateY(-1px); }
        .management-card .button.secondary { background-color: #444; }
        .management-card .button.secondary:hover { background-color: #555; }
    </style>
</head>
<body>

<!-- ======================= HEADER CONDICIONAL ======================= -->
<header>
    <!-- HEADER PARA USUÁRIO NÃO LOGADO -->
    <div sec:authorize="isAnonymous()" class="page-header public-header">
        <div class="logo-title">
            <h1>GameTests Platform</h1>
            <p>Otimize seus Testes de Software</p>
        </div>
        <div class="auth-links">
            <a th:href="@{/login}">Login</a>
        </div>
    </div>

    <!-- HEADER PARA USUÁRIOS LOGADOS (TESTADOR E ADMIN) -->
    <div sec:authorize="isAuthenticated()" class="page-header">
        <div class="logo-title">
            <h1 sec:authorize="hasRole('ADMIN')">Painel Administrativo</h1>
            <h1 sec:authorize="hasRole('TESTER') and !hasRole('ADMIN')">Painel do Testador</h1>
            <p>GameTests Management Suite</p>
        </div>
        <div class="user-info">
            <span>Olá, <strong sec:authentication="principal.username"></strong>!</span>
            <!-- Formulário de Logout é mais seguro que um link GET -->
            <form th:action="@{/logout}" method="post" style="display: inline; margin-left: 20px;">
                <button type="submit" class="logout-button">Sair</button>
            </form>
        </div>
    </div>
</header>

<!-- ======================= CONTEÚDO PRINCIPAL CONDICIONAL ======================= -->
<main>
    <!-- ===== CONTEÚDO PARA USUÁRIO NÃO LOGADO ===== -->
    <div sec:authorize="isAnonymous()" class="page-content-container">
        <h2 class="welcome-title">Bem-vindo(a) à Nossa Plataforma!</h2>
        <p class="welcome-subtitle">
            Explore um repositório completo de estratégias de teste, projetado para ajudar você a
            melhorar a qualidade e a eficiência dos seus projetos de software.
        </p>
        <div class="management-card" style="max-width: 500px; text-align: center;">
            <h3>Estratégias de Teste</h3>
            <p>Navegue por diversas estratégias, cada uma com descrições detalhadas, exemplos práticos e dicas.</p>
            <a th:href="@{/strategies}" class="management-card .button">Visualizar Estratégias</a>
        </div>
    </div>

    <!-- ===== CONTEÚDO PARA ADMINISTRADOR ===== -->
    <div sec:authorize="hasRole('ADMIN')" class="dashboard-container">
        <div class="welcome-message">
            <h2>Bem-vindo(a) de volta!</h2>
            <p>Utilize os painéis abaixo para gerenciar os recursos do sistema.</p>
        </div>
        <div class="management-sections">
            <div class="management-card">
                <h3>Gerenciar Projetos</h3>
                <p>Crie novos projetos, edite informações existentes ou remova projetos obsoletos.</p>
                <div class="actions"><a th:href="@{/projetos}" class="button secondary">Listar/Gerenciar Projetos</a></div>
            </div>
            <div class="management-card">
                <h3>Gerenciar Estratégias</h3>
                <p>Defina e refine as estratégias de teste que podem ser aplicadas nas sessões.</p>
                <div class="actions" style="display: flex; flex-direction: column; gap: 10px;">
                    <a th:href="@{/strategies}" class="button secondary">Listar/Gerenciar</a>
                    <a th:href="@{/strategies/create}" class="button">Criar Nova</a>
                </div>
            </div>
            <div class="management-card">
                <h3>Gerenciar Usuários</h3>
                <p>Administre contas de usuário, atribua papéis e monitore atividades.</p>
                <div class="actions" style="display: flex; flex-direction: column; gap: 10px;">
                    <a th:href="@{/admin/users/admins}" class="button secondary">Gerenciar Admins</a>
                    <a th:href="@{/admin/users/testers}" class="button secondary">Gerenciar Testadores</a>
                </div>
            </div>
            <div class="management-card">
                <h3>Gerenciar Sessões de Teste</h3>
                <p>Visualize todas as sessões de teste, edite detalhes ou remova sessões.</p>
                <div class="actions"><a th:href="@{/sessoes}" class="button secondary">Listar Todas as Sessões</a></div>
            </div>
        </div>
    </div>

    <!-- ===== CONTEÚDO PARA TESTADOR (QUE NÃO É ADMIN) ===== -->
    <div sec:authorize="hasRole('TESTER') and !hasRole('ADMIN')" class="dashboard-container">
        <div class="welcome-message">
            <h2>Bem-vindo(a) ao seu painel!</h2>
            <p>Aqui você pode iniciar novas sessões de teste, acompanhar seu progresso e visualizar estratégias.</p>
            <div class="quick-action">
                <a th:href="@{/sessoes/nova}" class="button-primary">Iniciar Nova Sessão de Teste</a>
            </div>
        </div>
        <div class="dashboard-grid">
            <div class="main-content-area">
                <div class="content-card">
                    <h3>Minhas Sessões Recentes</h3>
                    <div th:if="${not #lists.isEmpty(sessoesRecentes)}">
                        <div th:each="sessao : ${sessoesRecentes}" class="list-item">
                            <p><strong>Sessão ID:</strong> <span th:text="${sessao.id}">1</span> | <strong>Projeto ID:</strong> <span th:text="${sessao.idProjeto}">1</span></p>
                            <p><strong>Estratégia:</strong> <span th:text="${sessao.estrategia != null ? sessao.estrategia.nome : 'N/A'}">TDD</span></p>
                            <p><strong>Status:</strong> <span class="status" th:classappend="'status-' + ${sessao.status}" th:text="${sessao.status}">EM_EXECUCAO</span></p>
                            <p><strong>Criada em:</strong> <span th:text="${#temporals.format(sessao.dataCriacao, 'dd/MM/yy HH:mm')}">01/01/24 10:00</span></p>
                            <a th:href="@{/sessoes/detalhes(id=${sessao.id})}" class="action-link">Ver Detalhes</a>
                        </div>
                        <a th:href="@{/sessoes/listar}" class="view-all-link">Ver Todas as Minhas Sessões</a>
                    </div>
                    <div th:if="${#lists.isEmpty(sessoesRecentes)}">
                        <p class="no-data">Nenhuma sessão de teste recente encontrada.</p>
                    </div>
                </div>
                <div class="content-card">
                    <h3>Projetos Disponíveis</h3>
                    <div th:if="${not #lists.isEmpty(projetosDisponiveis)}">
                        <div th:each="projeto : ${projetosDisponiveis}" class="list-item">
                            <p><strong><span th:text="${projeto.nome}"></span></strong> (ID: <span th:text="${projeto.id}"></span>)</p>
                            <p th:text="${projeto.descricao}"></p>
                            <a th:href="@{/sessoes/nova(idProjeto=${projeto.id})}" class="action-link">Iniciar Sessão neste Projeto</a>
                        </div>
                        <a th:href="@{/projetos/listar}" class="view-all-link">Ver Todos os Projetos</a>
                    </div>
                    <div th:if="${#lists.isEmpty(projetosDisponiveis)}">
                        <p class="no-data">Nenhum projeto disponível para iniciar sessões.</p>
                    </div>
                </div>
            </div>
            <div class="sidebar-area">
                <div class="content-card">
                    <h3>Estratégias de Teste</h3>
                    <div th:if="${not #lists.isEmpty(estrategias)}">
                        <div th:each="estrategia : ${estrategias}" class="estrategia-item">
                            <h4 th:text="${estrategia.nome}">Nome da Estratégia</h4>
                            <p th:title="${estrategia.descricao}" th:text="${#strings.abbreviate(estrategia.descricao, 100)}">Descrição...</p>
                        </div>
                        <a th:href="@{/strategies}" class="view-all-link">Ver Todas as Estratégias</a>
                    </div>
                    <div th:if="${#lists.isEmpty(estrategias)}">
                        <p class="no-data">Nenhuma estratégia de teste cadastrada.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer class="page-footer">
    © <span th:text="${#dates.year(#dates.createNow())}">2024</span> GameTests Platform. Todos os direitos reservados.
</footer>

</body>
</html>